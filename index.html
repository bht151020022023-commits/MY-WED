<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tracker Cloud</title>

<style>
body{
    font-family:Arial;
    text-align:center;
    margin-top:40px;
    background:#f4f6f9;
}
button{
    padding:8px 15px;
    margin:5px;
    border:none;
    border-radius:8px;
    cursor:pointer;
}
.btn-main{background:#2196F3;color:white;}
.btn-add{background:#4CAF50;color:white;}
.box{
    width:60%;
    margin:auto;
    margin-top:15px;
    background:white;
    padding:12px;
    border-radius:8px;
    box-shadow:0 0 8px rgba(0,0,0,0.1);
}
input{
    padding:6px;
    margin:5px;
}
.hidden{display:none;}
</style>
</head>
<body>

<h2>üî• Tracker Online</h2>

<button id="smokeBtn" class="btn-main">üö¨ H√∫t thu·ªëc</button>
<button id="runBtn" class="btn-main">üèÉ Ch·∫°y b·ªô</button>

<div id="smokeBox" class="hidden box"></div>
<div id="runBox" class="hidden box"></div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc } 
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

/* üî• CONFIG C·ª¶A √îNG */
const firebaseConfig = {
  apiKey: "AIzaSyDFgBUsVGUWoj-b2qGj4DyUpALlch2MSQ",
  authDomain: "bhtz-a7f60.firebaseapp.com",
  projectId: "bhtz-a7f60",
  storageBucket: "bhtz-a7f60.firebasestorage.app",
  messagingSenderId: "708884006477",
  appId: "1:708884006477:web:de2a3e37f6513d6676be04",
  measurementId: "G-V82LF2YGS4"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let data = {};
const today = new Date().toISOString().split("T")[0];

/* LOAD DATA */
async function loadData(){
    const snap = await getDoc(doc(db,"tracker","main"));
    if(snap.exists()){
        data = snap.data();
    }
    render();
}

/* SAVE DATA */
async function saveData(){
    await setDoc(doc(db,"tracker","main"), data);
}

/* INIT STRUCTURE */
function ensureStructure(){
    if(!data.smoke) data.smoke = {};
    if(!data.run) data.run = {};
    if(!data.smoke[today]) data.smoke[today] = {count:0};
    if(!data.run[today]) data.run[today] = {km:0,hour:0};
}

/* SMOKE */
function addSmoke(){
    ensureStructure();
    data.smoke[today].count++;
    saveData();
    render();
}

/* RUN */
function addRun(){
    const km = parseFloat(document.getElementById("kmInput").value);
    const hour = parseFloat(document.getElementById("hourInput").value);
    if(!km || !hour) return;

    ensureStructure();
    data.run[today].km += km;
    data.run[today].hour += hour;
    saveData();
    render();
}

/* RENDER UI */
function render(){

    ensureStructure();

    document.getElementById("smokeBox").innerHTML = `
        <h3>üö¨ H√¥m nay (${today})</h3>
        <p>S·ªë l·∫ßn: ${data.smoke[today].count}</p>
        <button class="btn-add" onclick="addSmoke()">+1 l·∫ßn</button>
    `;

    document.getElementById("runBox").innerHTML = `
        <h3>üèÉ H√¥m nay (${today})</h3>
        <p>${data.run[today].km} km | ${data.run[today].hour} gi·ªù</p>
        <input type="number" id="kmInput" placeholder="Km">
        <input type="number" id="hourInput" placeholder="Gi·ªù">
        <button class="btn-add" onclick="addRun()">L∆∞u</button>
    `;
}

/* TOGGLE */
document.getElementById("smokeBtn").onclick=()=>{
    document.getElementById("smokeBox").classList.toggle("hidden");
};

document.getElementById("runBtn").onclick=()=>{
    document.getElementById("runBox").classList.toggle("hidden");
};

window.addEventListener("load", loadData);

window.addSmoke = addSmoke;
window.addRun = addRun;

</script>

</body>
</html>
