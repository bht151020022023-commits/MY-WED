<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Web cá»§a Há»¯u Thiá»‡n</title>

<style>
:root{
    --bg:#0f0f0f;
    --box:#1a1a1a;
    --border:#333;
    --text:#ffffff;
    --muted:#aaaaaa;
    --green:#2ecc71;
    --orange:#e67e22;
    --blue:#2196F3;
}

body{
    font-family:Arial, sans-serif;
    background:var(--bg);
    color:var(--text);
    text-align:center;
    margin:0;
    padding:30px 0;
}

h2,h3,h4{margin:10px 0;}

button{
    padding:8px 14px;
    margin:5px;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-weight:bold;
    transition:0.2s;
}

button:hover{transform:scale(1.05);}

.btn-main{background:var(--blue);color:white;}
.btn-add{background:var(--green);color:black;}
.btn-undo{background:var(--orange);color:black;}

.box{
    width:70%;
    margin:15px auto;
    background:var(--box);
    padding:15px;
    border-radius:12px;
    border:1px solid var(--border);
    text-align:left;
}

input{
    padding:7px;
    margin:5px;
    background:#121212;
    border:1px solid var(--border);
    color:white;
    border-radius:6px;
}

.hidden{display:none;}

.slide{
    max-height:0;
    overflow:hidden;
    transition:max-height 0.4s ease;
}

.slide.active{max-height:1000px;}

.progress{
    background:#333;
    height:8px;
    border-radius:5px;
    margin-top:5px;
}

.progress-bar{
    height:8px;
    border-radius:5px;
    background:var(--green);
}
</style>
</head>
<body>

<div id="login">
<h2>ğŸ” Nháº­p máº­t kháº©u</h2>
<input type="password" id="passInput">
<br><br>
<button onclick="App.login()">ÄÄƒng nháº­p</button>
<p id="loginError" style="color:red;"></p>
</div>

<div id="app" class="hidden">
<h2>ğŸ”¥ Web cá»§a Há»¯u Thiá»‡n</h2>
<p style="color:var(--muted)">Há»‡ thá»‘ng theo dÃµi cÃ¡ nhÃ¢n ğŸš¬ğŸƒ</p>
<button onclick="App.logout()">ğŸšª ÄÄƒng xuáº¥t</button>
<br><br>

<button class="btn-main" onclick="UI.toggle('smoke')">ğŸš¬ HÃºt thuá»‘c</button>
<button class="btn-main" onclick="UI.toggle('run')">ğŸƒ Cháº¡y bá»™</button>

<div id="smokeBox" class="box hidden"></div>
<div id="runBox" class="box hidden"></div>
</div>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc }
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig={
 apiKey:"AIzaSyDFgBUsVGUWoj-b2qGj4DyUpALlch2MSQ",
 authDomain:"bhtz-a7f60.firebaseapp.com",
 projectId:"bhtz-a7f60",
 storageBucket:"bhtz-a7f60.firebasestorage.app",
 messagingSenderId:"708884006477",
 appId:"1:708884006477:web:de2a3e37f6513d6676be04"
};

const firebaseApp=initializeApp(firebaseConfig);
const db=getFirestore(firebaseApp);

const App={
 PASS:"15102002",
 data:{smoke:{},run:{}},

 async init(){
  if(localStorage.getItem("auth")==="true"){
   login.classList.add("hidden");
   app.classList.remove("hidden");
  }
  await this.load();
  Features.renderSmoke();
  Features.renderRun();
 },

 login(){
  if(passInput.value===this.PASS){
   localStorage.setItem("auth","true");
   login.classList.add("hidden");
   app.classList.remove("hidden");
  }else loginError.innerText="Sai máº­t kháº©u!";
 },

 logout(){
  localStorage.removeItem("auth");
  location.reload();
 },

 async load(){
  const snap=await getDoc(doc(db,"tracker","main"));
  if(snap.exists()) this.data=snap.data();
  if(!this.data.smoke) this.data.smoke={};
  if(!this.data.run) this.data.run={};
 },

 async save(){
  await setDoc(doc(db,"tracker","main"),this.data);
 }
};

const UI={
 toggle(type){
  document.getElementById(type+"Box").classList.toggle("hidden");
 }
};
const Features={

 renderSmoke(){
  smokeBox.innerHTML=`
  <h3>ğŸš¬ HÃºt thuá»‘c</h3>
  <input type="date" id="smokeDate">
  <button class="btn-add" onclick="Features.addSmoke()">ThÃªm</button>
  <button class="btn-undo" onclick="Features.undoSmoke()">HoÃ n tÃ¡c</button>

  <br><br>
  <input type="month" id="smokeMonth">
  <button onclick="Features.toggleSmokeMonth()">ğŸ“Š Thá»‘ng kÃª thÃ¡ng</button>

  <div id="smokeDay"></div>
  <div id="smokeMonthBox" class="slide"></div>
  `;
  smokeDate.value=new Date().toISOString().split("T")[0];
  this.updateSmokeDay();
 },

 addSmoke(){
  let d=smokeDate.value;
  if(!App.data.smoke[d]) App.data.smoke[d]={count:0,history:[]};
  App.data.smoke[d].count++;
  App.data.smoke[d].history.unshift(new Date().toLocaleTimeString());
  App.save(); this.updateSmokeDay();
 },

 undoSmoke(){
  let d=smokeDate.value;
  if(App.data.smoke[d]?.count>0){
   App.data.smoke[d].count--;
   App.data.smoke[d].history.shift();
   App.save(); this.updateSmokeDay();
  }
 },

 updateSmokeDay(){
  let d=smokeDate.value;
  let c=App.data.smoke[d]?.count||0;
  let html=`<h4>${d}: ${c} láº§n</h4>`;
  smokeDay.innerHTML=html;
 },

 toggleSmokeMonth(){
  smokeMonthBox.classList.toggle("active");
 },

 /* RUN */

 renderRun(){
  runBox.innerHTML=`
  <h3>ğŸƒ Cháº¡y bá»™</h3>
  <input type="date" id="runDate"><br>
  <input type="number" id="kmInput" placeholder="Km">
  <input type="number" id="hourInput" placeholder="Giá»">
  <input type="number" id="minInput" placeholder="PhÃºt">
  <button class="btn-add" onclick="Features.addRun()">LÆ°u</button>
  <button class="btn-undo" onclick="Features.undoRun()">HoÃ n tÃ¡c</button>
  <div id="runDay"></div>
  `;
  runDate.value=new Date().toISOString().split("T")[0];
 },

 addRun(){
  let d=runDate.value;
  if(!App.data.run[d]) App.data.run[d]={sessions:[]};
  App.data.run[d].sessions.unshift({
   km:+kmInput.value||0,
   h:+hourInput.value||0,
   m:+minInput.value||0,
   time:new Date().toLocaleTimeString()
  });
  App.save();
 },

 undoRun(){
  let d=runDate.value;
  if(App.data.run[d]?.sessions.length>0){
   App.data.run[d].sessions.shift();
   App.save();
  }
 }
};

window.App=App;
window.UI=UI;
window.Features=Features;

window.onload=()=>App.init();
</script>
</body>
</html>
